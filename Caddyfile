alexandria.awfulsec.com {
    # Search API
    handle /search* {
        reverse_proxy 127.0.0.1:3001
    }

    # Health check endpoint
    handle /health {
        reverse_proxy 127.0.0.1:3001
    }

    # Main site - mdbook (default handler)
    handle {
        reverse_proxy 127.0.0.1:3000
    }

    encode gzip zstd
}

# Plausible Analytics - shared instance for all awfulsec.com services
analytics.awfulsec.com {
    reverse_proxy 127.0.0.1:8000
    encode gzip zstd
}
